<!DOCTYPE html>

<html lang="en">

    <head>
    	<meta charset="UTF-8">

    	{% load staticfiles %}
        <link rel='stylesheet' type='text/css' href="{% static 'css/bootstrap.css' %}" />
        <link rel='stylesheet' type='text/css' href="{% static 'css/bootstrap.min.css' %}" />
        <link rel='stylesheet' type='text/css' href="{% static 'css/dashboard.css' %}" />

        <script src="{% static "js/jquery-1.11.3.min.js" %}"></script>
	    <script src="{% static "js/jquery.redirect.js" %}"></script>
        <script src="{% static "js/bloodhound.js" %}"></script>
        <script src="{% static "js/handlebars-v4.0.0.js" %}"></script>
        <script src="{% static "js/bootstrap.min.js" %}"></script>
        <script src="{% static "js/ontology-typeahead.js" %}"></script>
        <script src="{% static "js/underscore-min.js" %}"></script>
        <script src="{% static "js/typeahead.min.js" %}"></script>
        <script src="{% static "js/jquery.redirect.js" %}"></script>
    	<script src="{% static "js/utils.js" %}"></script>


        <style>

            /*
                http://stackoverflow.com/questions/28222672/navigate-html-table-rows-with-javascript
                http://jsfiddle.net/vsgkjssq/5/
            */

            * {
                font-family:'Verdana', Arial, Sans-Serif;
                box-sizing: border-box;
            }
            table {
                border: 1px solid black;
            }
            table, tr, td {
                border: 1px solid lightgray;
                padding: 2px;
            }
            table, td {
                border-collapse:collapse;
                border: solid 1px #ccc;
                padding: 2px 4px;
                text-align: center;
            }
            tr:nth-child(2n) {
                background: #fffffe;
            }
            .beta, .beta td, .beta tr {
                border:0px;
            }

        </style>

	    <title>B2Note prototype interface</title>

    </head>

    <body>

        {% if subject_tofeed|length = 0 %}

            <script>

                window.parent.document.getElementById('b2note_iframe').style.visibility="hidden";

            </script>

        {% else %}

            <script>

                window.parent.document.getElementById('b2note_iframe').style.visibility="visible";

            </script>


            <script>

                //http://stackoverflow.com/questions/6754935/how-to-close-an-iframe-within-iframe-itself

                function closeWin() {

                    window.parent.document.getElementById('b2note_iframe').style.visibility="hidden";

                }

            </script>

            <div align="right">

                <table class="beta">

                    <td style="border:0px">
                        <form action="export_annotations" method="post">
                            <input type="hidden" name="subject_tofeed" value="{{subject_tofeed}}" readonly="readonly" />
                            <input type="hidden" name="pid_tofeed" value="{{pid_tofeed}}" readonly="readonly" />
                            <input type="Submit" value="Export" title="All your annotations as JSON"/>
                        </form>
                    </td>

                    <td>
                        <form action="publish_annotations" method="post">
                            <input type="hidden" name="subject_tofeed" value="{{subject_tofeed}}" readonly="readonly" />
                            <input type="hidden" name="pid_tofeed" value="{{pid_tofeed}}" readonly="readonly" />
                            <input type="Submit" value = "Publish" title = "Make annotations available to SPARQL queries"/>
                        </form>
                    </td>

                    <td>
                        <form action="settings" method="post">
                            <input type="hidden" name="subject_tofeed" value="{{subject_tofeed}}" readonly="readonly" />
                            <input type="hidden" name="pid_tofeed" value="{{pid_tofeed}}" readonly="readonly" />
                            <input type="Submit" value = "Settings" title = "Manage source ontologies"/>
                        </form>
                    </td>

                    <td><input class = question name="Close" type ="button" value = "x" title = "Close B2Note interface" onClick = "closeWin()" /></td>

                </table>

            </div>

            <h2 align="center">B2Note interface</h2>

            <hr><br>

            <div id="subject" align="center">

                Subject: <b>{{subject_tofeed}}</b>
		{% if pid_tofeed != "" %}
                <br />
                <p style="font-size:8px">{{ pid_tofeed }}</p>
		{% endif %}

            </div>

            <br><hr>

            <div>

                <h3>Create annotation</h3>

<!--                <p> Type keyword: </p> -->

<!--                    <input type="text" style="width: 250px;" value="# Solr-based autocomplete goes here #" readonly/> -->
		   <div class="form-group">
                       <input type="text" class="form-control" style="width: 250px;" name="q" id="id_q" value="{{ query }}"  placeholder="Type keyword"  autocomplete="off" spellcheck="false" dir="auto" />
		   </div>

            </div>

            <br><hr>

            <div>

                <h3>Existing annotations</h3>

                    <div border="1" style="height:150px;width:100%;overflow:auto;">
                        <table>
                            {% for annotation in annotation_list %}
                                {% if subject_tofeed in annotation.triple.subject.iri %}
                                    {% if annotation.triple.object.label != "" %}
                                        <tr><form action="delete_annotation" method="post">
                                           <input type="hidden" name="db_id" value="{{annotation.id}}" readonly="readonly" />
                                           <input type="hidden" name="subject_tofeed" value="{{subject_tofeed}}" readonly="readonly" />
                                           <input type="hidden" name="pid_tofeed" value="{{pid_tofeed}}" readonly="readonly" />
                                        {% if "http://" in annotation.triple.object.iri %}
                                            <td id="predicateLabel" style="width:20%;text-align:center">{{annotation.triple.predicate.label}}</td>
                                            <!-- http://stackoverflow.com/questions/15712880/load-iframe-links-into-parent-window -->
                                            <td id="objectLabel" style="width:75%"><a target="_blank" href={{annotation.triple.object.iri}}>{{annotation.triple.object.label}}</a></td>
                                        {% else %}
                                            <td id="predicateLabel" style="width:20%;text-align:center">{{annotation.triple.predicate.label}}</td>
                                            <td id="objectLabel" style="width:75%">{{annotation.triple.object.label}}</td>
                                        {% endif %}
                                        <!-- https://commons.wikimedia.org/wiki/File:Emojione_274C.svg -->
                                        <td id="delAnnotation" style="width:5%"><input type="image" width="8px" src="{% static "images/Emojione_274C.svg" %}" title="Delete annotation" alt="Delete annotation" /></td>
                					    </form></tr>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        </table>
                    </div>

            </div>

        {% endif %}

    </body>

</html>
