{% extends "b2note_app/__base.html" %}

{% block content %}

    {% if subject_tofeed|length = 0 %}

    <script>hide_iframe();</script>

    {% else %}

    <script>show_iframe();</script>

    {% endif %}

    <div class="container" id="section_create">

        <div class="container" id="user_area">

            {% if duplicate %}

                <p>Not created, an identical annotation already exists. <a href="/interface_main" class="btn btn-default">OK</a></p>

                <br>

                {% if duplicate.shortform %}

                    <input type="text" value="{{duplicate.label}} ({{duplicate.shortform}})" readonly>

                {% else %}

                    <input type="text" value="{{duplicate.label}}" readonly>

                {% endif %}

            {% elif new_semantic %}

                <p>The semantic annotation was created. <a href="/interface_main" class="btn btn-default">OK</a></p>

                <br>

                <input type="text" value="{{new_semantic.label}} ({{new_semantic.shortform}})" readonly>

            {% elif new_keyword %}

                <p>The free-text keyword annotation was created. <a href="/interface_main" class="btn btn-default">OK</a></p>

                <br>

                <input type="text" value="{{new_keyword.label}}" readonly>

            {% elif new_comment %}

                <p>The comment annotation was created. <a href="/interface_main" class="btn btn-default">OK</a></p>

                <br>

                <textarea name="comment_text" rows="3" class="form-control custom-control" id="created_comment_input" readonly>{{new_comment.label}}</textarea>

            {% elif annotation_deleted %}

                {% if annotation_deleted == "success" %}

                    <p>The annotation was deleted. <a href="/interface_main" class="btn btn-default">OK</a></p>

                    <br>

                {% elif annotation_deleted == "abort" %}

                    <p>The annotation could not be deleted. <a href="/interface_main" class="btn btn-default">OK</a></p>

                    <br>

                {% endif %}

            {% elif has_semantic_equivalent %}

                <p>We detected semantic terms matching your keyword.</p>

                <p>Would you like to select one?</p>

                <p>Or carry on with free-text?</p>

                <form action="/interface_main" method="post">
                    {% csrf_token %}
                    <input type="text" name="subject_tofeed" value="{{subject_tofeed}}" hidden>
                    <input type="text" name="textinput_primer" value="{{has_semantic_equivalent}}" hidden>
                    <input type="submit" class="btn btn-default" name="semantic_submit" id="primed_semantic_submit" value="Semantic" title="Create a semantic annotation."/>
                </form>

                <form action="/create_annotation" method="post">
                    {% csrf_token %}
                    <input type="text" name="subject_tofeed" value="{{subject_tofeed}}" hidden>
                    <input type="text" name="confirm_flag" value="confirmed" hidden>
                    <input type="text" name="keyword_text" value="{{has_semantic_equivalent}}" hidden>
                    <input type="submit" class="btn btn-default" name="keyword_submit" id="confirmed_keyword_submit" value="Keyword" title="Create the free-text keyword annotation."/>
                </form>

                <a href="/interface_main" class="btn btn-default">Cancel</a>

            {% elif long_keyword %}

                <p>This text seems long for a keyword (>60 characters).</p>

                <p>Do you want to use it as ... ?</p>

                <form action="/create_annotation" method="post">
                    {% csrf_token %}
                    <input type="text" name="subject_tofeed" value="{{subject_tofeed}}" hidden>
                    <input type="text" name="enforce_flag" value="confirmed" hidden>
                    <input type="text" name="confirm_flag" value="confirmed" hidden>
                    <input type="text" name="keyword_text" value="{{long_keyword}}" hidden>
                    <input type="submit" class="btn btn-default" name="keyword_submit" id="enforced_keyword_submit" value="Keyword" title="Create the free-text keyword annotation."/>
                </form>

                <form action="/create_annotation" method="post">
                    {% csrf_token %}
                    <input type="text" name="subject_tofeed" value="{{subject_tofeed}}" hidden>
                    <input type="text" name="comment_text" value="{{long_keyword}}" hidden>
                    <input type="submit" class="btn btn-default" name="comment_submit" id="primed_comment_submit" value="Comment" title="Create a comment annotation."/>
                </form>

                <a href="/interface_main" class="btn btn-default">Cancel</a>

            {% else %}

                <!-- http://stackoverflow.com/questions/18036315/centering-bootstrap-input-fields -->
                <ul class="nav nav-tabs">
                    <li class="active"><a data-toggle="tab" href="#semantic">Semantic tag</a></li>
                    <li><a data-toggle="tab" href="#keyword">Free-text keyword</a></li>
                    <li><a data-toggle="tab" href="#comment">Comment</a></li>
                </ul>
                <div id="homepage_tab_contents" class="tab-content">
                    <div id="semantic" class="tab-pane fade in active form-group">
                        <div id="semantic_container" class="container">
                            <form class="form-inline" action="/create_annotation" method="post">
                                <div id="semantic_formgroup" class="form-group">
                                    {% csrf_token %}
                                    <input type="hidden" name="ontology_json" id="ontology_json">
                                    <input type="text" name="subject_tofeed" id="semantic_target_id" value="{{subject_tofeed}}" hidden>
                                    {% if textinput_primer %}
                                        <input type="text" class="form-control" name="q" id="id_q" value="{% if query %}{{ query }}{% else %}{{textinput_primer}}{% endif %}" autocomplete="off" spellcheck="false" dir="auto" autofocus/>
                                    {% else %}
                                        <input type="text" class="form-control" name="q" id="id_q" value="{{ query }}" placeholder="Type-in to select a tag." autocomplete="off" spellcheck="false" dir="auto" autofocus/>
                                    {% endif %}
                                    <input type="submit" class="btn btn-default" name="semantic_submit" id="semantic_submit" value="Create" title="Create an annotation using my selected tag."/>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div id="keyword" class="tab-pane fade form-group">
                        <div id="keyword_container" class="container">
                            <form action="/create_annotation" method="post">
                                <div id="keyword_formgroup" class="form-group">
                                    {% csrf_token %}
                                    <div class="input-group">
                                        <input type="text" name="subject_tofeed" id="keyword_target_id" value="{{subject_tofeed}}" hidden>
                                        <input type="text" name="keyword_text" class="form-control custom-control" id="keyword_input" placeholder="Type-in a keyword."/>
                                        <!--<span class="input-group-addon btn btn-primary" title="Create an annotation using my free-text keyword." onClick="get_free_text()">Create</span>-->
                                        <input type="submit" class="btn btn-default" name="keyword_submit" id="keyword_submit" value="Create" title="Create an annotation using my free-text keyword."/>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div id="comment" class="tab-pane fade form-group">
                        <div id="comment_container" class="container">
                            <form action="/create_annotation" method="post">
                                <div id="comment_formgroup" class="form-group">
                                    {% csrf_token %}
                                    <div class="input-group">
                                        {% csrf_token %}
                                        <input type="text" name="subject_tofeed" id="comment_target_id" value="{{subject_tofeed}}" hidden>
                                        <textarea name="comment_text" rows="2" class="form-control custom-control" id="comment_input" placeholder="Type your comment."></textarea>
                                        <input type="submit" class="btn btn-default" name="comment_submit" id="comment_submit" value="Create" title="Create an annotation using my comment."/>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

            {% endif %}

            <hr>

            <div class="container">
                <a class="btn btn-link" data-toggle="collapse" href="#myannotation_collapse">
                    <i class="glyphicon glyphicon-triangle-right"></i>
                </a>
                <a href="/myannotations">My annotations</a>
                <div id="myannotation_collapse" class="panel-collapse collapse">
                    <table>
                        <tr>
                            <div class = "container">
                                {% if my_s != None %}
                                <td><a href="/myannotations#semantic" title="Click for full list.">Semantic tag</a></td>
                                <td>
                                    <a href="/myannotations#semantic" title="Click for full list.">
                                        <svg height="20" width="20">
                                            {% if my_s > 9 %}
                                                <circle cx="10" cy="10" r="10" style="fill:rgb(64,196,96);fill-opacity:0.5;" />
                                                <text x="1" y="15" fill="black">{{my_s}}</text>
                                            {% else %}
                                                <circle cx="10" cy="10" r="10" style="fill:rgb(64,196,96);fill-opacity:0.5;" />
                                                <text x="5" y="15" fill="black">{{my_s}}</text>
                                            {% endif %}
                                        </svg>
                                    </a>
                                </td>
                                {% endif %}
                            </div>
                        </tr>
                        <tr>
                            <div class = "container">
                                {% if my_k != None %}
                                <td><a href="/myannotations#keyword" title="Click for full list.">Free-text keyword</a></td>
                                <td>
                                    <a href="/myannotations#keyword" title="Click for full list.">
                                        <svg height="20" width="20">
                                            {% if my_k > 9 %}
                                                <circle cx="10" cy="10" r="10" style="fill:rgb(64,196,96);fill-opacity:0.5;" />
                                                <text x="1" y="15" fill="black">{{my_k}}</text>
                                            {% else %}
                                                <circle cx="10" cy="10" r="10" style="fill:rgb(64,196,96);fill-opacity:0.5;" />
                                                <text x="5" y="15" fill="black">{{my_k}}</text>
                                            {% endif %}
                                        </svg>
                                    </a>
                                </td>
                                {% endif %}
                            </div>
                        </tr>
                        <tr>
                            <div class = "container">
                                {% if my_c != None %}
                                <td><a href="/myannotations#comment" title="Click for full list.">Comment</a></td>
                                <td>
                                    <a href="/myannotations#comment" title="Click for full list.">
                                        <svg height="20" width="20">
                                            {% if my_c > 9 %}
                                                <circle cx="10" cy="10" r="10" style="fill:rgb(64,196,96);fill-opacity:0.5;" />
                                                <text x="1" y="15" fill="black">{{my_c}}</text>
                                            {% else %}
                                                <circle cx="10" cy="10" r="10" style="fill:rgb(64,196,96);fill-opacity:0.5;" />
                                                <text x="5" y="15" fill="black">{{my_c}}</text>
                                            {% endif %}
                                        </svg>
                                    </a>
                                </td>
                                {% endif %}
                            </div>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="container" id="pulledarea">
        <a class="btn btn-link" data-toggle="collapse" href="#allannotations_collapse">
            <i class="glyphicon glyphicon-triangle-right"></i>
        </a>
        <a href="/allannotations">All annotations</a>
        <div id="allannotations_collapse" class="panel-collapse collapse">
            <table>
                <tr>
                    <div class = "container">
                        <td><a href="/allannotations#semantic">Semantic tag</a></td>
                        <td>
                            {% if all_s != None %}
                                <a href="/allannotations#semantic" title="All semantic annotations, click for full list.">
                                    <svg height="20" width="20">
                                        {% if all_s > 9 %}
                                            <circle cx="10" cy="10" r="10" style="fill:rgb(64,96,196);fill-opacity:0.5;" />
                                            <text x="1" y="15" fill="black">{{all_s}}</text>
                                        {% else %}
                                            <circle cx="10" cy="10" r="10" style="fill:rgb(64,96,196);fill-opacity:0.5;" />
                                            <text x="5" y="15" fill="black">{{all_s}}</text>
                                        {% endif %}
                                    </svg>
                                </a>
                            {% endif %}
                        </td>
                        <td>
                            {% if my_s != None %}
                                <a href="/myannotations#semantic" title="Only my semantic annotations, click for full list.">
                                    <svg height="20" width="20">
                                        {% if my_s > 9 %}
                                            <circle cx="10" cy="10" r="10" style="fill:rgb(64,196,96);fill-opacity:0.5;" />
                                            <text x="1" y="15" fill="black">{{my_s}}</text>
                                        {% else %}
                                            <circle cx="10" cy="10" r="10" style="fill:rgb(64,196,96);fill-opacity:0.5;" />
                                            <text x="5" y="15" fill="black">{{my_s}}</text>
                                        {% endif %}
                                    </svg>
                                </a>
                            {% endif %}
                        </td>
                    </div>
                </tr>
                <tr>
                    <div class = "container">
                        <td><a href="/allannotations#keyword">Free-text keyword</a></td>
                        <td>
                            {% if all_k != None %}
                                <a href="/allannotations#keyword" title="All keyword annotations, click for full list.">
                                    <svg height="20" width="20">
                                        {% if all_k > 9 %}
                                            <circle cx="10" cy="10" r="10" style="fill:rgb(64,96,196);fill-opacity:0.5;" />
                                            <text x="1" y="15" fill="black">{{all_k}}</text>
                                        {% else %}
                                            <circle cx="10" cy="10" r="10" style="fill:rgb(64,96,196);fill-opacity:0.5;" />
                                            <text x="5" y="15" fill="black">{{all_k}}</text>
                                        {% endif %}
                                    </svg>
                                </a>
                            {% endif %}
                        </td>
                        <td>
                            {% if my_k != None %}
                                <a href="/myannotations#keyword" title="Only my keyword annotations, click for full list.">
                                    <svg height="20" width="20">
                                        {% if my_k > 9 %}
                                            <circle cx="10" cy="10" r="10" style="fill:rgb(64,196,96);fill-opacity:0.5;" />
                                            <text x="1" y="15" fill="black">{{my_k}}</text>
                                        {% else %}
                                            <circle cx="10" cy="10" r="10" style="fill:rgb(64,196,96);fill-opacity:0.5;" />
                                            <text x="5" y="15" fill="black">{{my_k}}</text>
                                        {% endif %}
                                    </svg>
                                </a>
                            {% endif %}
                        </td>
                    </div>
                </tr>
                <tr>
                    <div class = "container">
                        <td><a href="/allannotations#comment">Comment</a></td>
                        <td>
                            {% if all_c != None %}
                            <a href="/allannotations#comment" title="All comment annotations, click for full list.">
                                <svg height="20" width="20">
                                    {% if all_c > 9 %}
                                        <circle cx="10" cy="10" r="10" style="fill:rgb(64,96,196);fill-opacity:0.5;" />
                                        <text x="1" y="15" fill="black">{{all_c}}</text>
                                    {% else %}
                                        <circle cx="10" cy="10" r="10" style="fill:rgb(64,96,196);fill-opacity:0.5;" />
                                        <text x="5" y="15" fill="black">{{all_c}}</text>
                                    {% endif %}
                                </svg>
                            </a>
                            {% endif %}
                        </td>
                        <td>
                            {% if my_c != None %}
                            <a href="/myannotations#comment" title="Only my comment annotations, click for full list.">
                                <svg height="20" width="20">
                                    {% if my_c > 9 %}
                                        <circle cx="10" cy="10" r="10" style="fill:rgb(64,196,96);fill-opacity:0.5;" />
                                        <text x="1" y="15" fill="black">{{my_c}}</text>
                                    {% else %}
                                        <circle cx="10" cy="10" r="10" style="fill:rgb(64,196,96);fill-opacity:0.5;" />
                                        <text x="5" y="15" fill="black">{{my_c}}</text>
                                    {% endif %}
                                </svg>
                            </a>
                            {% endif %}
                        </td>
                    </div>
                </tr>
            </table>
        </div>
    </div>

    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>


{% endblock %}
