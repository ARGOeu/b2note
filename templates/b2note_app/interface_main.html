{% extends "b2note_app/__base.html" %}

{% block content %}

    {% if subject_tofeed|length = 0 %}

    <script>hide_iframe();</script>

    {% else %}

    <script>show_iframe();</script>

    {% endif %}

    <div class="container" id="section_create">

        <div class="container" id="user_area">

            {% if duplicate %}
                <div class="container" style="float:left;margin:10px;">
                    <table>
                        <tr>
                            <td>Not created, an identical annotation already exists.</td>
                            <td rowspan="2"><a href="/interface_main" class="btn btn-default" style="margin:5px;">OK</a></td>
                        </tr>
                        <tr>
                            <td>
                                {% if duplicate.shortform %}
                                    <input type="text" value="{{duplicate.label}} ({{duplicate.shortform}})" readonly>
                                {% else %}
                                    <input type="text" value="{{duplicate.label}}" readonly>
                                {% endif %}
                            </td>
                        </tr>
                    </table>
                </div>

            {% elif new_semantic %}

                <div class="container" style="float:left;margin:10px;">
                    <table>
                        <tr>
                            <td>The semantic annotation was created.</td>
                            <td rowspan="2"><a href="/interface_main" class="btn btn-default" style="margin:5px;">OK</a></td>
                        </tr>
                        <tr>
                            <td><input type="text" value="{{new_semantic.label}} ({{new_semantic.shortform}})" readonly></td>
                        </tr>
                    </table>
                </div>

            {% elif new_keyword %}

                <div class="container" style="float:left;margin:10px;">
                    <table>
                        <tr>
                            <td>The free-text keyword annotation was created.</td>
                            <td rowspan="2"><a href="/interface_main" class="btn btn-default" style="margin:5px;">OK</a></td>
                        </tr>
                        <tr>
                            <td><input type="text" value="{{new_keyword.label}}" readonly></td>
                        </tr>
                    </table>
                </div>

            {% elif new_comment %}

                <div class="container" style="float:left;margin:10px;">
                    <table>
                        <tr>
                            <td>The comment annotation was created.</td>
                            <td rowspan="2"><a href="/interface_main" class="btn btn-default" style="margin:5px;">OK</a></td>
                        </tr>
                        <tr>
                            <td>
                                <textarea name="comment_text" rows="3" class="form-control custom-control" id="created_comment_input" readonly>{{new_comment.label}}</textarea>
                            </td>
                        </tr>
                    </table>
                </div>

            {% elif annotation_deleted %}

                {% if annotation_deleted == "success" %}

                    <div class="container" style="float:left;margin:10px;">
                        <table>
                            <tr>
                                <td>The annotation was deleted.</td>
                                <td><a href="/interface_main" class="btn btn-default" style="margin:5px;">OK</a></td>
                            </tr>
                        </table>
                    </div>

                {% elif annotation_deleted == "abort" %}

                    <div class="container" style="float:left;margin:10px;">
                        <table>
                            <tr>
                                <td>The annotation was not be deleted.</td>
                                <td><a href="/interface_main" class="btn btn-default" style="margin:5px;">OK</a></td>
                            </tr>
                        </table>
                    </div>

                {% endif %}

            {% elif has_semantic_equivalent %}

                <div class="container" style="float:left;margin:10px;text-align:center;">
                    <table>
                        <tr><td colspan="3">We detected <strong>semantic terms</strong> matching your keyword.</td></tr>
                        <tr><td colspan="3">Would you like to select one?</td></tr>
                        <tr><td colspan="3">Or carry on with free-text?</td></tr>
                        <tr><td colspan="3"><p> </p></td></tr>
                        <tr>
                            <td>
                                <form action="/interface_main" method="post">
                                    {% csrf_token %}
                                    <input type="text" name="subject_tofeed" value="{{subject_tofeed}}" hidden>
                                    <input type="text" name="textinput_primer" value="{{has_semantic_equivalent}}" hidden>
                                    <input type="submit" class="btn btn-default" name="semantic_submit" id="primed_semantic_submit" value="Semantic" title="Create a semantic annotation."/>
                                </form>
                            </td>
                            <td>
                                <form action="/create_annotation" method="post">
                                    {% csrf_token %}
                                    <input type="text" name="subject_tofeed" value="{{subject_tofeed}}" hidden>
                                    <input type="text" name="confirm_flag" value="confirmed" hidden>
                                    <input type="text" name="keyword_text" value="{{has_semantic_equivalent}}" hidden>
                                    <input type="submit" class="btn btn-default" name="keyword_submit" id="confirmed_keyword_submit" value="Keyword" title="Create the free-text keyword annotation."/>
                                </form>
                            </td>
                            <td><a href="/interface_main" class="btn btn-default">Cancel</a></td>
                        </tr>
                    </table>
                </div>
                <br>
                <hr>

            {% elif long_keyword %}

                <div class="container" style="float:left;margin:10px;text-align:center;">
                    <table>
                        <tr><td colspan="3">This text seems <strong>long</strong> for a keyword (>60 characters).</td></tr>
                        <tr><td colspan="3">Do you want to use it as ... ?</td></tr>
                        <tr><td colspan="3"><p> </p></td></tr>
                        <tr>
                            <td>
                                <form action="/create_annotation" method="post">
                                    {% csrf_token %}
                                    <input type="text" name="subject_tofeed" value="{{subject_tofeed}}" hidden>
                                    <input type="text" name="enforce_flag" value="confirmed" hidden>
                                    <input type="text" name="confirm_flag" value="confirmed" hidden>
                                    <input type="text" name="keyword_text" value="{{long_keyword}}" hidden>
                                    <input type="submit" class="btn btn-default" name="keyword_submit" id="enforced_keyword_submit" value="Keyword" title="Create the free-text keyword annotation."/>
                                </form>
                            </td>
                            <td>
                                <form action="/create_annotation" method="post">
                                    {% csrf_token %}
                                    <input type="text" name="subject_tofeed" value="{{subject_tofeed}}" hidden>
                                    <input type="text" name="comment_text" value="{{long_keyword}}" hidden>
                                    <input type="submit" class="btn btn-default" name="comment_submit" id="primed_comment_submit" value="Comment" title="Create a comment annotation."/>
                                </form>
                            </td>
                            <td><a href="/interface_main" class="btn btn-default">Cancel</a></td>
                        </tr>
                    </table>
                </div>

            {% else %}

                <!-- http://stackoverflow.com/questions/18036315/centering-bootstrap-input-fields -->
                <ul class="nav nav-tabs" id="create_tabs">
                    <li class="active"><a data-toggle="tab" href="#semantic">Semantic tag</a></li>
                    <li><a data-toggle="tab" href="#keyword">Free-text keyword</a></li>
                    <li><a data-toggle="tab" href="#comment">Comment</a></li>
                </ul>
                <div id="homepage_tab_contents" class="tab-content">
                    <div id="semantic" class="tab-pane fade in active form-group">
                        <div id="semantic_container" class="container">
                            <form class="form-inline" action="/create_annotation" method="post">
                                <div id="semantic_formgroup" class="form-group">
                                    {% csrf_token %}
                                    <input type="hidden" name="ontology_json" id="ontology_json">
                                    <input type="text" name="subject_tofeed" id="semantic_target_id" value="{{subject_tofeed}}" hidden>
                                    {% if textinput_primer %}
                                        <input type="text" class="form-control" name="q" id="id_q" value="{% if query %}{{ query }}{% else %}{{textinput_primer}}{% endif %}" autocomplete="off" spellcheck="false" dir="auto" autofocus/>
                                    {% else %}
                                        <input type="text" class="form-control" name="q" id="id_q" value="{{ query }}" placeholder="Type-in to select a tag." autocomplete="off" spellcheck="false" dir="auto" autofocus/>
                                    {% endif %}
                                    <input type="submit" class="btn btn-default" name="semantic_submit" id="semantic_submit" value="Create" title="Create an annotation using my selected tag."/>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div id="keyword" class="tab-pane fade form-group">
                        <div id="keyword_container" class="container">
                            <form action="/create_annotation" method="post">
                                <div id="keyword_formgroup" class="form-group">
                                    {% csrf_token %}
                                    <div class="input-group">
                                        <input type="text" name="subject_tofeed" id="keyword_target_id" value="{{subject_tofeed}}" hidden>
                                        <input type="text" name="keyword_text" class="form-control custom-control" id="keyword_input" placeholder="Type-in a keyword."/>
                                        <!--<span class="input-group-addon btn btn-primary" title="Create an annotation using my free-text keyword." onClick="get_free_text()">Create</span>-->
                                        <input type="submit" class="btn btn-default" name="keyword_submit" id="keyword_submit" value="Create" title="Create an annotation using my free-text keyword."/>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div id="comment" class="tab-pane fade form-group">
                        <div id="comment_container" class="container">
                            <form action="/create_annotation" method="post">
                                <div id="comment_formgroup" class="form-group">
                                    {% csrf_token %}
                                    <div class="input-group">
                                        {% csrf_token %}
                                        <input type="text" name="subject_tofeed" id="comment_target_id" value="{{subject_tofeed}}" hidden>
                                        <textarea name="comment_text" rows="2" class="form-control custom-control" id="comment_input" placeholder="Type your comment."></textarea>
                                        <input type="submit" class="btn btn-default" name="comment_submit" id="comment_submit" value="Create" title="Create an annotation using my comment."/>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

            {% endif %}

            <hr>

            <div class="container">
                <!--<a class="btn btn-link" data-toggle="collapse" href="#myannotation_collapse">
                    <i class="glyphicon glyphicon-triangle-right"></i>
                </a>-->
                <span class="caret caret-lg" data-toggle="collapse" href="#myannotation_collapse" style="border-width:8px;"></span>
                <a href="/myannotations"><span class="badge" style="font-weight: 400;opacity: 0.8;background: #40c460;font-size:14px;">My annotations</span></a>
                <div id="myannotation_collapse" class="panel-collapse collapse">
                    <table class="table table-condensed table-responsive" id="myannot_table_main">
                        <tr>
                            <!--<div class = "container">-->
                                {% if my_s != None %}
                                    <td><a href="/myannotations#semantic" title="Click for full list.">Semantic tag</a></td>
                                    <td>
                                        <a href="/myannotations#semantic" title="Click for full list." style="padding:2px">
                                            <span class="badge">{{my_s}}</span>
                                        </a>
                                        <!--<a href="/myannotations#semantic" title="Click for full list.">
                                            <svg height="20" width="20">
                                                {% if my_s > 9 %}
                                                    <circle cx="10" cy="10" r="10" style="fill:rgb(64,196,96);fill-opacity:0.5;" />
                                                    <text x="1" y="15" fill="black">{{my_s}}</text>
                                                {% else %}
                                                    <circle cx="10" cy="10" r="10" style="fill:rgb(64,196,96);fill-opacity:0.5;" />
                                                    <text x="5" y="15" fill="black">{{my_s}}</text>
                                                {% endif %}
                                            </svg>
                                        </a>-->
                                    </td>
                                {% endif %}
                            <!--</div>-->
                        </tr>
                        <tr>
                            <div class = "container">
                                {% if my_k != None %}
                                    <td><a href="/myannotations#keyword" title="Click for full list.">Free-text keyword</a></td>
                                    <td>
                                        <a href="/myannotations#keyword" title="Click for full list." style="padding:2px">
                                            <span class="badge">{{my_k}}</span>
                                        </a>
                                    </td>
                                {% endif %}
                            </div>
                        </tr>
                        <tr>
                            <div class = "container">
                                {% if my_c != None %}
                                    <td><a href="/myannotations#comment" title="Click for full list.">Comment</a></td>
                                    <td>
                                        <a href="/myannotations#comment" title="Click for full list." style="padding:2px">
                                            <span class="badge">{{my_c}}</span>
                                        </a>
                                    </td>
                                {% endif %}
                            </div>
                        </tr>
                    </table>
                </div>
            </div>
            <br>
        </div>
    </div>

    <br>

    <div class="container" id="pulledarea">
        <div class="container" id="for_padding_adjsutement">
            <!--<a class="btn btn-link" data-toggle="collapse" href="#allannotations_collapse">
                <i class="glyphicon glyphicon-triangle-right"></i>
            </a>-->
            <span class="caret caret-lg" data-toggle="collapse" href="#allannotations_collapse" style="border-width:8px;"></span>
            <a href="/allannotations"><span class="badge" style="font-weight: 400;opacity: 0.8;background: #2040a4;font-size:14px;">All annotations</span></a>
            <div id="allannotations_collapse" class="panel-collapse collapse">
                <table  class="table table-condensed table-responsive" id="allannot_table_main">
                    <tr>
                        <div class = "container">
                            <td><a href="/allannotations#semantic">Semantic tag</a></td>
                            <td>
                                {% if all_s != None %}
                                    <a href="/allannotations#semantic" title="All semantic annotations,&#13click for full list." style="padding:2px">
                                        <span class="badge">{{all_s}}</span>
                                    </a>
                                {% endif %}
                            </td>
                            <td>
                                {% if my_s != None %}
                                    <a href="/myannotations#semantic" title="My semantic annotations,&#13click for full list." style="padding:2px">
                                        <span class="badge" id="my_sem_{{ forloop.counter0 }}">{{my_s}}</span>
                                    </a>
                                {% endif %}
                            </td>
                        </div>
                    </tr>
                    <tr>
                        <div class="container">
                            <td><a href="/allannotations#keyword">Free-text keyword</a></td>
                            <td>
                                {% if all_k != None %}
                                    <a href="/allannotations#keyword" title="All keyword annotations,&#13click for full list." style="padding:2px">
                                        <span class="badge">{{all_k}}</span>
                                    </a>
                                {% endif %}
                            </td>
                            <td>
                                {% if my_k != None %}
                                    <a href="/myannotations#keyword" title="My keyword annotations,&#13click for full list." style="padding:2px">
                                        <span class="badge" id="my_key_{{ forloop.counter0 }}">{{my_k}}</span>
                                    </a>
                                {% endif %}
                            </td>
                        </div>
                    </tr>
                    <tr>
                        <div class = "container">
                            <td><a href="/allannotations#comment">Comment</a></td>
                            <td>
                                {% if all_c != None %}
                                    <a href="/allannotations#comment" title="All comment annotations,&#13click for full list." style="padding:2px">
                                        <span class="badge">{{all_c}}</span>
                                    </a>
                                {% endif %}
                            </td>
                            <td>
                                {% if my_c != None %}
                                    <a href="/myannotations#comment" title="My comment annotations,&#13click for full list." style="padding:2px">
                                        <span class="badge" id="my_com_{{ forloop.counter0 }}">{{my_c}}</span>
                                    </a>
                                {% endif %}
                            </td>
                        </div>
                    </tr>
                </table>
            </div>
        </div>
    </div>


{% endblock %}
